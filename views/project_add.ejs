<!DOCTYPE html>
<html>
  <head>
    <title>Adicionar Usuário</title>
    <link rel='stylesheet' href='/stylesheets/projects_style.css' />
    <link rel='stylesheet' href='/stylesheets/footer.css' />
  </head>
  <body>

      <header>

          <div class="navContainer">
            <nav class="headerNav">
              <img src="" alt=""/>
              <ul class="nav_bar">
    
                <div class="logo">
                  <h1><a href="/"><span class="thinnerLogo">LockIF</span>Manager</a></h1>
                </div>
    
                <div class="home">
                  <li class="nav_link"><a href="/">Home</a></li>
                </div>
    
                <div class="project">
                  <li class="nav_link"><a>Projeto<a>
                    <ul class="dropdown">
                      <li class="dropdown-item"><a href="/project/add">Adicionar projeto</a></li>
                      <li class="dropdown-item"><a href="/projects">Listar projetos</a></li>        
                    </ul>
                  </li>
                </div>
    
                <div class="user">
                  <li class="nav_link"><a>Usuário </a>
                    <ul class="dropdown">
                      <li class="dropdown-item"><a href="/user/add">Adicionar usuário</a></li>
                      <li class="dropdown-item"><a href="/users">Listar usuário</a></li>
                    </ul>
                  </li>
                </div>
    
              </ul>
            </nav>
          </div>
    
        </header>

    <section class="projectAdd">
      <form  class="main" class="forms" action="" method="post">
        <label for="">Nome do projeto</label>
        <input type="text" name="name" value="" />
        <label for="">Descrição</label>
        <textarea name="description" id="" cols="30" rows="5"></textarea>
        <label for="">Coordenador</label>
        <select name="coordinator" id="coordinator">
            <option value=""></option>
            <% user.forEach(function(u){ %>
              <option value="<%= u._id%>"><%= u.name%></option>
            <%});%>
          </select>
        <label for="">Participante(s)</label>
        
        <div id="divParticipants">
          <select id="participantsChoice" name="" >
            <option value=""></option>
            <% user.forEach(function(u){ %>
              <option value="<%= u._id%>"><%= u.name%></option>
            <%});%>
          </select>
          <a href="" id="add">+</a>
            <input type="hidden" name="participants" id="participants" value="[]">
        </div>   
        <button class="addButton">Adicionar Projeto</button>
      </form>
    </section>  

  <div id="addedParcipants"></div>


    <div class="footer">
      <h3>Feito <!-- <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Love_Heart_SVG.svg/645px-Love_Heart_SVG.svg.png" height="16px" width="auto">  -->
        por Vinicius e Emanuel em Dourados MS</h3>
      <h4>GEDAE - LockIFManager© 2019</h4>
    </div>

  </footer>
    
  </body>
  <script type='application/javascript'>
    const button = document.getElementById('add');
    var logica = true;
    button.addEventListener('click', function(e){
      e.preventDefault();
      var idUserSelected = document.getElementById('participantsChoice').value;
      var participants = JSON.parse(document.getElementById('participants').value);
      if(idUserSelected == ""){
        return
      }
    
      for(let i = 0;i < participants.length;i++){
        if(idUserSelected == participants[i]){
          logica = false;
        }
      }
      if(logica && document.getElementById('coordinator').value != idUserSelected){
        participants.push(idUserSelected);
        document.getElementById('participants').value = JSON.stringify(participants);
        var p = document.createElement('p');
        var userSelected = document.getElementById('participantsChoice').selectedOptions[0].innerHTML;
        p.innerHTML = userSelected;
        p.id = idUserSelected
        var a = document.createElement('a');
        a.id = idUserSelected;
        a.innerHTML = 'X'
        a.href = "#";
        a.onclick = removeTask;
        a.id = idUserSelected ;
        //var img = document.createElement('img');
        //img.src = '../public/img/trash.png';
        //img.alt = "Remover usuário";
        //a.appendChild(img)
        var divHTML = document.getElementById('addedParcipants');
        var div = document.createElement('div');
        div.id = idUserSelected;
        div.appendChild(p);
        div.appendChild(a);
        divHTML.appendChild(div);
        logica = true;
      }else {
        return logica = true
      }
    });

    function removeTask (event) {
      let participants = JSON.parse(document.getElementById('participants').value);
      var positionUser;
      var divChildren = document.getElementById('addedParcipants').children;
      var userId = event.target.id;
      console.log(userId);
      for(let i = 0;i < divChildren.length;i++ ){
        if(userId == divChildren[i].id){
          participants.splice(i,1);
          document.getElementById(`${userId}`).remove();
        }
      }
      document.getElementById('participants').value = JSON.stringify(participants);
      console.log(participants);
      for(let i = 0;i < participants.length;i++){
        if(userId == participants[i]){
          positionUser = [i];
        }
      }
      
    }

  </script>
</html>